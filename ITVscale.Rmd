---
title: "spatiotemporal patterns of trait variation"
author: "Pat Dumandan"
date: "11/13/2020"
output: html_document
---

## Question 1: How does variation in one temporal scale alter outcomes on larger temporal scales? (seasonal to annual)   
### 1: intra- and inter- trait variation seasonal and annual patterns
```{r setup, include=FALSE, message=FALSE, warning=FALSE}
Portal_rodent=read.csv("./PortalData/Rodents/Portal_rodent.csv")
Portal_plots=read.csv("./PortalData/SiteandMethods/Portal_plots.csv")
portal1=inner_join(Portal_rodent, Portal_plots, by= c("plot", "month", "year"))
require(dplyr)
require(raster)

target_sp=c("PB", "PP", "PE", "PF", "PM", "RM")
targ_s1=c(4,5) #months: Apr-May
targ_s2=c(8,9,10) #Months: Aug-Oct
```

### Interspecific variation: seasonal patterns (season 1: Apr-May-first seed drop)
*calculated by taking the mean trait value for each species and then calculating the CV across species (Jung et al., 2010)*    
**interspecific: 44.50 (if grouped by year), if not grouped by year=46.35, if grouped by species and year but indiv.values per month in the season:37.11**

```{r}
#interspecific variation across all years during first seed drop (Apr-May)

#grouped by species and year (separate value per year but average of the months of the season)
total_wgt_con1a=portal1%>%
  filter(species %in% target_sp,treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species, year)%>%
  summarise(mean_wgt=mean(wgt))

#grouped by species (1 mean value for each species but average of all months in the season across all years)
total_wgt_con1b=portal1%>%
  filter(species %in% target_sp,treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)%>%
  summarise(mean_wgt=mean(wgt))

#grouped by species and year (raw, 1 value per month per season, per year)
total_wgt_con1c=portal1%>%
  filter(species %in% target_sp,treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species, year)

cv(total_wgt_con1a$mean_wgt)
cv(total_wgt_con1b$mean_wgt)
cv(total_wgt_con1c$wgt)
```
#### *Q for Morgan: which is the most appropriate way to get the CV among the 3?*


### Intraspecific trait variation: seasonal patterns (season 1: Apr-May-first seed drop)  
*determined intraspecific variation by calculating the CVs of each species for each trait independently and then taking the mean of these values (Dawson and Jonsson, 2020)*
**mean CV of 6 species in Apr-May:21.06**

```{r}
#create function to calculate cv

itv_sp=function(species, weight){
  cv=sd(weight)/mean(weight)*100
  return(cv)
}

#create for loop to get a vector of CVs for all species
itv_season=vector(mode="numeric", length=length(target_sp))
species=as.vector(total_wgt_con1b$species)
weight=as.vector(total_wgt_con1b$mean_wgt)

for (i in 1:length(itv_season)){
  cv[i]=itv_sp(species=species[i], weight=weight[i])
  itv_season=cv[i]
}
cv
#species-specific data
PB_wgt_con=portal1%>%
  filter(species== "PB",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)
cv(PB_wgt_con$wgt) #intraspecific: 21.06

PP_wgt_con=portal1%>%
  filter(species== "PP", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)
cv(PP_wgt_con$wgt) #intraspecific: 16.83

PE_wgt_con=portal1%>%
  filter(species== "PE",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)
cv(PE_wgt_con$wgt) #intraspecific: 17.61

PF_wgt_con=portal1%>%
  filter(species== "PF",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species, treatment)
cv(PF_wgt_con$wgt) #intraspecific: 17.11

PM_wgt_con=portal1%>%
  filter(species== "PM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)
cv(PM_wgt_con$wgt) #intraspecific: 19.22

RM_wgt_con=portal1%>%
  filter(species== "RM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s1)%>%
  group_by(species)
cv(RM_wgt_con$wgt) #intraspecific: 17.08
```

#### Interspecific variation: seasonal patterns (season 2: Aug-Oct-second seed drop)
**interspecific: 42.06**

```{r}
total_wgt_con1=portal1%>%
  filter(species %in% target_sp, !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species, treatment)%>%
  summarise(mean_wgt=mean(wgt))
cv(total_wgt_con1$mean_wgt)  
```

#### Intraspecific trait variation: seasonal patterns (season 2: Aug-Oct-second seed drop)  
**mean CV of 6 species in Aug-Oct:16.47**

```{r}
PB_wgt_con2=portal1%>%
  filter(species== "PB",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(PB_wgt_con2$wgt) #intraspecific: 18.15

PP_wgt_con2=portal1%>%
  filter(species== "PP", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(PP_wgt_con2$wgt) #intraspecific: 16.47

PE_wgt_con2=portal1%>%
  filter(species== "PE",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(PE_wgt_con2$wgt) #intraspecific: 20.92

PF_wgt_con2=portal1%>%
  filter(species== "PF",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(PF_wgt_con2$wgt) #intraspecific: 18.20

PM_wgt_con2=portal1%>%
  filter(species== "PM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(PM_wgt_con2$wgt) #intraspecific: 18.21

RM_wgt_con2=portal1%>%
  filter(species== "RM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)
cv(RM_wgt_con2$wgt) #intraspecific: 26.98

itv_sp(RM, RM_wgt_con2$wgt)

```

#### Interspecific variation annual patterns

```{r}
total_wgt_con_yr=portal1%>%
  filter(species %in% target_sp,treatment=="control", !(age=="J"),!is.na(wgt))%>%
  group_by(species, year)%>%
  summarise(mean_wgt=mean(wgt))
str(total_wgt_con_yr)
cv(total_wgt_con_yr$mean_wgt) #43.96
```

#### Intraspecific trait variation: annual patterns 
**mean CV of 6 species: **

```{r}
#### Create function to calculate cv
itv_sp=function(species, weight){
cv=sd(weight)/mean(weight)*100
return(cv)
}

PB_wgt_con2=portal1%>%
  filter(species== "PB",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species, year)

PP_wgt_con2=portal1%>%
  filter(species== "PP", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)

PE_wgt_con2=portal1%>%
  filter(species== "PE",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)

PF_wgt_con2=portal1%>%
  filter(species== "PF",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species, treatment)

PM_wgt_con2=portal1%>%
  filter(species== "PM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)

RM_wgt_con2=portal1%>%
  filter(species== "RM",treatment=="control", !(age=="J"),!is.na(wgt),month %in% targ_s2)%>%
  group_by(species)

itv_sp(PB, PB_wgt_con2$wgt)

#using raster package:
cv(PB_wgt_con2$wgt) #intraspecific: 18.15
cv(PP_wgt_con2$wgt) #intraspecific: 16.47
cv(PE_wgt_con2$wgt) #intraspecific: 20.92
cv(PF_wgt_con2$wgt) #intraspecific: 18.20
cv(PM_wgt_con2$wgt) #intraspecific: 18.21
cv(RM_wgt_con2$wgt) #intraspecific: 26.98
```


